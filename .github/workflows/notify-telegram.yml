name: Notify Telegram on Release

on:
  release:
    types: [published]

jobs:
  notify:
    runs-on: ubuntu-latest
    env:
      TG_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
      TG_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      TG_THREAD_ID: ${{ secrets.TELEGRAM_THREAD_ID }}

    steps:
      - name: Send release notification to Telegram
        shell: bash
        run: |
          # –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ–ª–∞ —Ä–µ–ª–∏–∑–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º)
          BODY="${{ github.event.release.body }}"
          if [ -z "$BODY" ]; then BODY="‚Äî"; fi

          # –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –≤ –≤–∞—à–µ–º —Ñ–æ—Ä–º–∞—Ç–µ
          TEXT="üöÄ Project: ${{ github.event.repository.name }}
üõ†Ô∏è Release : ${{ github.event.release.tag_name }}
üìù Message:
$BODY
üîó Repository: ${{ github.event.repository.html_url }}"

          # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–ø–∏–∫ –≥—Ä—É–ø–ø—ã
          curl -s -X POST "https://api.telegram.org/bot${TG_TOKEN}/sendMessage" \
            -d chat_id="${TG_CHAT_ID}" \
            -d message_thread_id="${TG_THREAD_ID}" \
            --data-urlencode text="$TEXT"
