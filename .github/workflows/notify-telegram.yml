name: Notify Telegram on Release

on:
  release:
    types: [published]

jobs:
  notify:
    runs-on: ubuntu-latest
    env:
      TG_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
      TG_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      TG_THREAD_ID: ${{ secrets.TELEGRAM_THREAD_ID }}

    steps:
      - name: Send release notification to Telegram
  shell: bash
  run: |
    BODY="${{ github.event.release.body }}"
    if [ -z "$BODY" ]; then BODY="—"; fi

    TEXT=$(cat <<'EOF'
🚀 Project: ${{ github.event.repository.name }}
🛠️ Release : ${{ github.event.release.tag_name }}
📝 Message:
__BODY_PLACEHOLDER__
🔗 Repository: ${{ github.event.repository.html_url }}
EOF
)
    TEXT="${TEXT/__BODY_PLACEHOLDER__/$BODY}"

    curl -s -X POST "https://api.telegram.org/bot${TG_TOKEN}/sendMessage" \
      -d chat_id="${TG_CHAT_ID}" \
      -d message_thread_id="${TG_THREAD_ID}" \
      --data-urlencode text="$TEXT"
